import Head from "next/head";
import {UserButton, useUser} from "@clerk/nextjs";

import {api} from "~/utils/api";
import {FoodDiaryEntry} from "~/server/api/routers/foodEntry";
import dayjs from "dayjs";
import localizedFormat from 'dayjs/plugin/localizedFormat';
import {LoadingPage, LoadingSpinner} from "~/components/loading";
import CreateEntryWizard from "~/components/entryWizard";
dayjs.extend(localizedFormat)


export default function Home() {
    const {data: data, isLoading: resultsLoading} = api.foodDiary.getFoodDiaryEntry.useQuery({id: "e5aea67f-1fa2-4f0d-8c5f-b3f182b63431", userId: "TestAdmin"})
    if (resultsLoading) return LoadingPage()

    const user = useUser();

    const ShortDiaryView = (props: FoodDiaryEntry) => {
        return(
            <div className="flex gap-3">
                <div className="flex flex-col">
                    <div className="flex gap-3">
                        <div className="font-bold">{props.mealDescription}</div>
                        <div className="text-gray-500">{dayjs(props.entryTime).format(`LLLL`)}</div>
                    </div>
                    <div className="text-gray-500">{props.additionalComments}</div>
                    <div className="text-gray-500">{props.kilojoules}</div>
                </div>
            </div>
        )
    }
    return (
        <>
            <Head>
                <title>Create T3 App</title>
                <meta name="description" content="Generated by create-t3-app"/>
                <link rel="icon" href="/favicon.ico"/>
            </Head>
            <main className="flex justify-center h-screen">
                <div className=" w-full md:max-w-2xl border-x h-full border-b-slate-400">
                    <div className="flex border-b border-slate-400 p-4 ">
                        {!!user.isSignedIn && "hello " + user.user.firstName && <CreateEntryWizard/>}
                        <UserButton afterSignOutUrl="/"/>
                    </div>
                    <div className="flex flex-col">
                        <div>{ShortDiaryView(data!)}</div>
                    </div>
                </div>
            </main>
        </>
    );
}
